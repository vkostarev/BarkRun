{% extends "base.html" %}

{% block title %}Photos - {{ race.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1><i class="fas fa-images text-primary"></i> Race Photos</h1>
  <a href="{{ url_for('races') }}" class="btn btn-outline-secondary" onclick="if (window.history.length > 1) { history.back(); return false; }">
    <i class="fas fa-arrow-left"></i> Back
  </a>
</div>

<div class="card mb-3">
  <div class="card-body">
    <h5 class="card-title">{{ race.name }}</h5>
    <p class="text-muted mb-0">Start: {{ race.start_time | format_dt_paris('%Y-%m-%d %H:%M %Z') }}</p>
  </div>
</div>

{% if photos %}
  <div class="row g-3">
    {% for p in photos %}
    <div class="col-6 col-md-4 col-lg-3">
      <div class="card h-100">
        <a href="{{ url_for('view_race_photo', race_id=race.id, filename=p.file_name) }}" target="_blank">
          <img src="{{ url_for('view_race_photo', race_id=race.id, filename=p.file_name) }}" class="card-img-top" alt="photo">
        </a>
        <div class="card-body py-2 d-flex justify-content-between align-items-center">
          <div>
            <strong>#{{ loop.index }}</strong>
            <small class="text-muted ms-2">{{ (p.timestamp or p.uploaded_at) | since(race.start_time) }}</small>
          </div>
          {% if p.user_id %}
            {% if p.user_id == current_user.id %}
              <span class="badge bg-primary" title="You">ME</span>
            {% else %}
              <span class="badge bg-secondary" title="{{ user_name_by_id.get(p.user_id) }}">
                {{ user_name_by_id.get(p.user_id, 'Unknown') }}
              </span>
            {% endif %}
          {% else %}
            <span class="text-muted small">Unclaimed</span>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
{% else %}
  <div class="text-center text-muted py-4">
    <i class="fas fa-image fa-2x mb-2"></i>
    <p class="mb-0">No photos for this race.</p>
  </div>
{% endif %}
{% endblock %}

